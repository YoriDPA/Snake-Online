<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Jogo da Cobrinha - Ecrã Inteiro</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #1a1a1a;
            color: #ffffff;
            font-family: 'Press Start 2P', cursive;
            overflow: hidden;
            margin: 0;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            /* Previne o comportamento de "puxar para atualizar" em dispositivos móveis */
            overscroll-behavior-y: contain;
        }
        canvas {
            background-color: #000;
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }
        .ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }
        .score-display {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 1.5rem;
            color: #fff;
            text-shadow: 2px 2px 4px #000;
        }
        .game-dialog {
            background-color: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #3fff3f;
            text-align: center;
            box-shadow: 0 0 20px #3fff3f;
            pointer-events: all;
            width: 90%;
            max-width: 500px;
        }
        .game-dialog h1 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #3fff3f;
            line-height: 1.2;
        }
        .game-dialog p {
            font-size: 0.9rem;
            margin-bottom: 30px;
        }
        .game-button {
            background-color: #3fff3f;
            color: #000;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-family: 'Press Start 2P', cursive;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .game-button:hover {
            background-color: #fff;
            color: #3fff3f;
            box-shadow: 0 0 15px #fff;
        }
        .final-score {
            font-size: 1.5rem;
            color: #ffcc00;
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <!-- Canvas para o jogo -->
    <canvas id="gameCanvas"></canvas>

    <!-- Overlay da Interface do Utilizador -->
    <div class="ui-overlay">
        
        <!-- Ecrã de Início -->
        <div id="startScreen" class="game-dialog">
            <h1>COBRINHA TELA CHEIA</h1>
            <p>Use as SETAS ou DESLIZE O DEDO para mover.</p>
            <button id="startButton" class="game-button">Iniciar Jogo</button>
        </div>

        <!-- Ecrã de Fim de Jogo -->
        <div id="gameOverScreen" class="game-dialog hidden">
            <h1>FIM DE JOGO</h1>
            <p>A sua pontuação final foi:</p>
            <p id="finalScore" class="final-score">0</p>
            <button id="restartButton" class="game-button">Jogar Novamente</button>
        </div>

    </div>
    
    <!-- Display da Pontuação durante o jogo -->
    <div id="scoreDisplay" class="score-display hidden">Pontos: 0</div>

    <script>
        // Elementos da UI
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startScreen = document.getElementById('startScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const startButton = document.getElementById('startButton');
        const restartButton = document.getElementById('restartButton');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const finalScoreDisplay = document.getElementById('finalScore');

        // Configurações do Jogo
        let gridSize = 20;
        let snake, food, direction, score, speed, gameInterval, changingDirection;
        let touchStartX = 0;
        let touchStartY = 0;
        let touchEndX = 0;
        let touchEndY = 0;
        
        // Ajusta o canvas ao tamanho da janela
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // Função para desenhar no grid
        function draw(x, y, color) {
            ctx.fillStyle = color;
            ctx.fillRect(x * gridSize, y * gridSize, gridSize, gridSize);
            ctx.strokeStyle = '#000';
            ctx.strokeRect(x * gridSize, y * gridSize, gridSize, gridSize);
        }

        // Inicializa as variáveis do jogo
        function initializeGame() {
            const headX = Math.floor((canvas.width / gridSize) / 2);
            const headY = Math.floor((canvas.height / gridSize) / 2);
            snake = [{ x: headX, y: headY }];
            placeFood();
            direction = 'right';
            score = 0;
            speed = 150; // ms
            changingDirection = false;
            scoreDisplay.textContent = `Pontos: ${score}`;
        }
        
        // Posiciona a comida aleatoriamente
        function placeFood() {
            let foodX, foodY, onSnake;
            do {
                onSnake = false;
                foodX = Math.floor(Math.random() * (canvas.width / gridSize));
                foodY = Math.floor(Math.random() * (canvas.height / gridSize));
                for (const segment of snake) {
                    if (segment.x === foodX && segment.y === foodY) {
                        onSnake = true;
                        break;
                    }
                }
            } while (onSnake);
            food = { x: foodX, y: foodY };
        }

        // Loop principal do jogo
        function gameLoop() {
            if (isGameOver()) {
                clearInterval(gameInterval);
                gameOverScreen.classList.remove('hidden');
                scoreDisplay.classList.add('hidden');
                finalScoreDisplay.textContent = score;
                return;
            }

            changingDirection = false;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            draw(food.x, food.y, '#ff3333');

            moveSnake();
            snake.forEach((segment, index) => {
                const color = index === 0 ? '#3fff3f' : '#2cae2c';
                draw(segment.x, segment.y, color);
            });
        }

        // Verifica condições de fim de jogo
        function isGameOver() {
            const head = snake[0];
            if (head.x < 0 || head.x * gridSize >= canvas.width || head.y < 0 || head.y * gridSize >= canvas.height) {
                return true;
            }
            for (let i = 1; i < snake.length; i++) {
                if (head.x === snake[i].x && head.y === snake[i].y) {
                    return true;
                }
            }
            return false;
        }

        // Move a cobra
        function moveSnake() {
            const head = { x: snake[0].x, y: snake[0].y };
            switch (direction) {
                case 'up': head.y--; break;
                case 'down': head.y++; break;
                case 'left': head.x--; break;
                case 'right': head.x++; break;
            }
            snake.unshift(head);

            if (head.x === food.x && head.y === food.y) {
                score++;
                scoreDisplay.textContent = `Pontos: ${score}`;
                placeFood();
                speed = Math.max(50, speed - 2);
                clearInterval(gameInterval);
                gameInterval = setInterval(gameLoop, speed);
            } else {
                snake.pop();
            }
        }

        // Função unificada para mudar a direção
        function setDirection(newDirection) {
            if (changingDirection) return;

            const goingUp = direction === 'up';
            const goingDown = direction === 'down';
            const goingLeft = direction === 'left';
            const goingRight = direction === 'right';

            if (newDirection === 'up' && !goingDown) {
                direction = 'up';
                changingDirection = true;
            }
            if (newDirection === 'down' && !goingUp) {
                direction = 'down';
                changingDirection = true;
            }
            if (newDirection === 'left' && !goingRight) {
                direction = 'left';
                changingDirection = true;
            }
            if (newDirection === 'right' && !goingLeft) {
                direction = 'right';
                changingDirection = true;
            }
        }

        // Controla a direção via teclado
        function handleKeyDown(event) {
            switch (event.key) {
                case 'ArrowUp': setDirection('up'); break;
                case 'ArrowDown': setDirection('down'); break;
                case 'ArrowLeft': setDirection('left'); break;
                case 'ArrowRight': setDirection('right'); break;
            }
        }

        // Controla a direção via toque (swipe)
        function handleTouchStart(event) {
            event.preventDefault();
            touchStartX = event.touches[0].clientX;
            touchStartY = event.touches[0].clientY;
        }

        function handleTouchEnd(event) {
            event.preventDefault();
            touchEndX = event.changedTouches[0].clientX;
            touchEndY = event.changedTouches[0].clientY;
            handleSwipe();
        }

        function handleSwipe() {
            const dx = touchEndX - touchStartX;
            const dy = touchEndY - touchStartY;
            const swipeThreshold = 30; // Mínimo de pixels para considerar um swipe

            if (Math.abs(dx) > Math.abs(dy)) { // Swipe horizontal
                if (Math.abs(dx) > swipeThreshold) {
                    setDirection(dx > 0 ? 'right' : 'left');
                }
            } else { // Swipe vertical
                if (Math.abs(dy) > swipeThreshold) {
                    setDirection(dy > 0 ? 'down' : 'up');
                }
            }
        }

        // Inicia o jogo
        function startGame() {
            startScreen.classList.add('hidden');
            gameOverScreen.classList.add('hidden');
            scoreDisplay.classList.remove('hidden');
            initializeGame();
            gameInterval = setInterval(gameLoop, speed);
            
            // Adiciona os event listeners
            document.addEventListener('keydown', handleKeyDown);
            canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
            canvas.addEventListener('touchend', handleTouchEnd, { passive: false });
        }

        // Event Listeners dos botões
        startButton.addEventListener('click', startGame);
        restartButton.addEventListener('click', startGame);

    </script>
</body>
</html>